<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		*{
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		.todo_component{
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 50px;
			font-family: 'Helvetica Neue',sans-serif;
		}

		.todoform{
			margin: 30px 0;
			display: flex;
			justify-content: flex-start;
			align-items: center;
		}
		.task_input, .save_input{
			height: 30px;
			border-radius: 3px;
			width: 200px;
			outline: none;
		}
		.task_input{
			border: 1px solid #e2e2e2;
		}
		.save_input{
			width: 60px;
			color: #ffffff;
			background-color: seagreen;
			border: none;
			cursor: pointer;
		}

		.done{
			text-decoration: line-through;
		}

		.del_btn, .edit_btn {
			width: 24px;
			height: 24px;
			margin-left: 20px;
			display: inline-block;
			cursor: pointer;
		}

		.edit_btn {
			background: url('edit.png') no-repeat center;
			background-size: contain;
		}
		.del_btn {
			background: url('delete.png') no-repeat center;
			background-size: contain;
		}

		.hidden{
			display: none;
		}

	</style>
</head>
<body>

	<div class="todo_component">

		<h1>To Do List</h1>
		<form class="todoform">
			<input class="task_input" name="task" type="text" placeholder="Type your task">
			<input class="save_input" type="submit" value="Save">
		</form>

		<h3 class="hint">Any tasks yet. Type any in input above</h3>
		<ol class="todolist"></ol>
	</div>

<script>

//  to do list
// markup: form text+submit, list, h3 +
// add new task +
// mark as done +
// delete task + 
// edit task + 
// save to local storage / get from local storage ***    +
// refactoring

const form = document.querySelector('.todoform');
const input = document.querySelector('.task_input');
const list = document.querySelector('.todolist');
const hint = document.querySelector('.hint');
const APP_NAME = 'ToDoList_JS0523';
const storage = window.localStorage;

function saveToLS(){
	storage.setItem(APP_NAME, JSON.stringify(todos));
}

function getFromLS(){
	return storage.getItem(APP_NAME) != null ? JSON.parse(storage.getItem(APP_NAME)) : []; // get returns [] : null
}

function checkTodos(){
	if(todos.length === 0){
		hint.style.display = 'block';
		list.style.display = 'none';
	}
	else{
		hint.style.display = 'none';
		list.style.display = 'block';
	}
}

const todos = getFromLS();
checkTodos();
if(todos.length > 0){
	for(let t of todos){
		createTodoListItem(t);
	}
}

function saveTask(){
	let text = input.value;
	if(text.length < 3){
		console.error('Too short task');
		return;
	}
	const id = Date.now();
	const todo = {
		task: text,
		done: false,
		id: id
	}
	todos.push(todo);

	input.value = '';
	if(todos.length === 1){
		checkTodos();
	}
	createTodoListItem(todo);
	saveToLS();
}


function createTodoListItem(todo){

	let li = document.createElement('li');
	li.dataset.id = todo.id;

	let span = document.createElement('span');
	span.innerText = todo.task;
	li.append(span);

	let innerInput = document.createElement('input');
	innerInput.classList.add('hidden');
	li.append(innerInput);


	let del = document.createElement('span');
	del.classList.add('del_btn');
	li.append(del);

	let edit = document.createElement('span');
	edit.classList.add('edit_btn');
	li.append(edit);


	list.append(li);
}

function markAsDone(el){
	el.classList.toggle('done');
	let id = +el.dataset.id;

	todos.forEach(item=>{
		if(item.id === id){
			item.done = !item.done; // if was true set false, if was false, set true
		}
	});
	saveToLS();
}

function deleteTask(el){
	let id = +el.dataset.id;
	el.remove(); // delete from markup
	todos.forEach((item, index) =>{
		if(item.id === id){
			todos.splice(index, 1); // remove todo  from array
		}
	});
	if(todos.length === 0){
		checkTodos();
	}
	saveToLS();
}

function editTask(el){
	let id = +el.dataset.id;
	let span = el.querySelector('span');
	let input = el.querySelector('input');

	input.value = span.innerText; // записати поточний текст завдання в інпут

	span.classList.add('hidden');
	input.classList.remove('hidden');

	input.onkeyup = (e) => {
		if(e.key === 'Enter'){
			span.innerText = input.value; // записати поточний текст завдання з інпуту в спан
			span.classList.remove('hidden');
			input.classList.add('hidden');

			todos.forEach((item) =>{
				if(item.id === id){
					item.task = input.value;
				}
			});
		}
	}
	saveToLS();
}

form.onsubmit = (event) => {
	event.preventDefault();
	saveTask();
}

list.addEventListener('click', (e) => {
	if(e.target.tagName.toLowerCase() === 'li'){
		markAsDone(e.target);
	}
	if(e.target.tagName.toLowerCase() === 'span'){
		markAsDone(e.target.parentNode);
	}
	if(e.target.classList.contains('del_btn')){
		deleteTask(e.target.parentNode);
	}
	if(e.target.classList.contains('edit_btn')){
		editTask(e.target.parentNode);
	}
});

</script>
</body>
</html>
